!function(e){var t={};function s(i){if(t[i])return t[i].exports;var n=t[i]={i:i,l:!1,exports:{}};return e[i].call(n.exports,n,n.exports,s),n.l=!0,n.exports}s.m=e,s.c=t,s.d=function(e,t,i){s.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},s.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},s.t=function(e,t){if(1&t&&(e=s(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(s.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)s.d(i,n,function(t){return e[t]}.bind(null,n));return i},s.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return s.d(t,"a",t),t},s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},s.p="",s(s.s=0)}([function(e,t,s){"use strict";s.r(t);const i={blockWords:"catalyst,innovator,futurist,serial entrepreneur,midas list",confirm:!0,count:0,whiteList:{}},n=15e3,r=100,o=e=>"https://api.twitter.com/1.1/users/lookup.json?skip_status=1&screen_name="+e,a="https://twitter.com/i/api/1.1/blocks/create.json",c=e=>`https://twitter.com/i/api/graphql/Vf8si2dfZ1zmah8ePYPjDQ/UserByScreenNameWithoutResults?variables=%7B%22screen_name%22%3A%22${e}%22%2C%22withHighlightedLabel%22%3Atrue%7D`,u=navigator.userAgent.indexOf("Firefox")>-1,l=navigator.userAgent.indexOf("Edg/")>-1,d=!!window.opr,h=navigator.vendor.match(/apple/i)&&!navigator.userAgent.match(/crios/i)&&!navigator.userAgent.match(/fxios/i),k=e=>u?browser:window.chrome;class g{static get keys(){return{blockWords:"blockWords",confirm:"confirm",count:"count",whiteList:"whiteList"}}static get storageImplementation(){return d||u?chrome.storage.local:chrome.storage.sync}static parseKeywords(e){return(e[g.keys.blockWords]||i.blockWords).split(",")}static getSettings(e){g.get(null,t=>{const{confirm:s,blockWords:n,whiteList:r}=g.keys,o={...i,...t,[s]:void 0===t[s]?i.confirm:t[s],[n]:g.parseKeywords(t),[r]:t[r]||{}};e(o)})}static getBlockCount(e){g.get(g.keys.count,t=>e(parseInt(t[g.keys.count]||0)))}static setBlockedWords(e,t){const s=(e||"").toLowerCase().split(",").map(e=>(e||"").trim()).filter(e=>e.length).join(",");g.save(g.keys.blockWords,s,t)}static setConfirmationSetting(e,t){g.save(g.keys.confirm,!!e,t)}static incrementCount(){g.get(g.keys.count,e=>{const t=(e[g.keys.count]||0)+1;g.save(g.keys.count,t),k().runtime.sendMessage({increment:t})})}static addWhiteList(e,t){g.get(g.keys.whiteList,s=>{const i={...s[g.keys.whiteList]||{},...e};g.save(g.keys.whiteList,i),t(i)})}static get(e,t){g.storageImplementation.get(e,t)}static save(e,t,s){g.storageImplementation.set({[e]:t},s)}}class p{static mapUser({description:e,screen_name:t,id_str:s,name:i}){return{bio:e,id:s,name:i,handle:t}}static parseResponse(e,t,s,i){try{s(t(JSON.parse(e)))}catch(e){i()}}static getTheBio(e,t,s,i,n){const r=new XMLHttpRequest;r.open("POST",o(e.join(",")),!0),r.setRequestHeader("Authorization",t),r.setRequestHeader("x-csrf-token",s),r.onload=e=>{4===r.readyState&&p.parseResponse(r.response,e=>e.map(p.mapUser),i,n)},r.onerror=e=>n(),r.send()}static doTheBlock(e,t,s){const i=new window.XMLHttpRequest;i.open("POST",a,!0),i.setRequestHeader("content-type","application/x-www-form-urlencoded"),i.setRequestHeader("Authorization",t),i.setRequestHeader("x-csrf-token",s),i.setRequestHeader("x-twitter-active-user","yes"),i.setRequestHeader("x-twitter-auth-type","OAuth2Session"),i.onload=e=>{200===i.status&&g.incrementCount()},i.send("user_id="+e)}static isBlocking(e,t,s,i){const n=new window.XMLHttpRequest,r=()=>i(!1);n.open("GET",c(e),!0),n.setRequestHeader("Authorization",t),n.setRequestHeader("x-csrf-token",s),n.onload=e=>{4===n.readyState&&p.parseResponse(n.response,e=>e.data.user.legacy.blocking,i,r)},n.onerror=r,n.send()}}class m{static get queue(){return this._pendingQueue||[]}static get isEmpty(){return 0===m.queue.length}static add(e){this._pendingQueue=m.queue.concat([e])}static addAll(e){this._pendingQueue=m.queue.concat(e)}static inQueue(e){return m.queue.indexOf(e)>=0}static takeNext(){const e=Math.min(m.queue.length,r);return m.queue.splice(0,e)}static clear(){this._pendingQueue=[]}}class f{static get list(){return this._handleCheckList||[]}static add(e){this._handleCheckList=f.list.concat(e)}static remove(e){this._handleCheckList=f.list.filter(t=>e.indexOf(t)<0)}static isChecked(e){return f.list.indexOf(e)>=0}static clear(){this._handleCheckList=[]}}class y{static get whiteList(){return this._whiteList||{}}static set whiteList(e){this._whiteList=e}static add(e,t){g.addWhiteList({[e]:t},e=>{y.whiteList=e})}static contains(e){return!!y.whiteList[e]}}class w{static get handledList(){return f}static get pendingQueue(){return m}static get whiteList(){return y}static get lastBioTimestamp(){return this._bioRequest}static set lastBioTimestamp(e){this._bioRequest=e}static get lastBioExpired(){const e=Date.now()-w.lastBioTimestamp;return Math.abs(e)>n}static get tokens(){return this._tokens}static set tokens(e){this._tokens=e}static get ready(){return!!(w.tokens&&w.tokens.csrfToken&&w.tokens.bearerToken)}static get keyList(){return this._keyList}static set keyList(e){this._keyList=e}static get confirmBlocks(){return this._confirm}static set confirmBlocks(e){this._confirm=e}}class b{constructor(){b.loadSettings(b.startWatch),b.registerListener()}static registerListener(){window.chrome.runtime.onMessage.addListener(e=>{if(e.updateSettings)return b.loadSettings(),!0})}static loadSettings(e){g.getSettings(t=>{w.keyList=t[g.keys.blockWords],w.confirmBlocks=t[g.keys.confirm],w.whiteList.whiteList=t[g.keys.whiteList],e&&e()})}static obtainTokens(e){k().runtime.sendMessage({tokens:!0},({bearer:t,csrf:s})=>{w.tokens={bearerToken:t,csrfToken:s},w.ready&&e&&e()})}static startWatch(){new MutationObserver(b.onDomChange).observe(document.body,{subtree:!0,childList:!0}),b.lookForDouches()}static onDomChange(e){for(const t of e)"childList"===t.type&&b.lookForDouches()}static lookForDouches(){w.ready?b.findHandles():b.obtainTokens(b.findHandles)}static findHandles(){const e=document.getElementsByTagName("a");for(let t=0;t<e.length;t++)b.processLinks(e[t]);b.requestBios()}static processLinks(e){if(b.isHandleLink(e)){e.classList.add("dbt___seen-it-b4");const t=b.parseHandle(e);w.handledList.isChecked(t)||w.pendingQueue.inQueue(t)||w.pendingQueue.add(t)}}static isHandleLink(e){return!!(e.innerText&&"link"===e.getAttribute("role")&&!e.classList.contains("dbt___seen-it-b4")&&e.innerText.indexOf("@")>=0)}static parseHandle(e){const t=e.innerText.substr(e.innerText.indexOf("@")+1),[s]=t.split(/\s+/,1);return s}static requestBios(){if(!(!w.pendingQueue.isEmpty&&(!w.lastBioTimestamp||w.lastBioExpired)))return;w.lastBioTimestamp=Date.now();const e=w.pendingQueue.takeNext();p.getTheBio(e,w.tokens.bearerToken,w.tokens.csrfToken,t=>{w.handledList.add(e),b.processBios(t)},()=>{w.pendingQueue.addAll(e)})}static processBios(e){if(!e||!e.length)return;const t=e.filter(b.isBlockMatch),s=b.limitAlertCount(t);b.sequentiallyBlock(s)}static isBlockMatch(e){const{bio:t,id:s}=e;return s&&t&&!w.whiteList.contains(s)&&b.checkWords(w.keyList,t)}static checkWords(e,t){for(let s=0;s<e.length;s++)if(new RegExp(e[s],"gmi").test(t))return!0;return!1}static limitAlertCount(e){if(!w.confirmBlocks||!e||e.length<=3)return e;const t=e.slice(0,3),s=e.slice(3).map(({handle:e})=>e);return w.handledList.remove(s),w.pendingQueue.addAll(s),t}static sequentiallyBlock(e){if(e&&e.length){const t=e.shift();p.isBlocking(t.handle,w.tokens.bearerToken,w.tokens.csrfToken,s=>{s?b.sequentiallyBlock(e):b.executeBlock(t).then(t=>b.sequentiallyBlock(e)).catch()})}}static buildAlert(e,t){const s=`${t} : ${(e||"").replace(/\s\s+/g," ")}`;return k().i18n.getMessage("doucheAlert")+"\n==================================\n"+s+"\n==================================\n\n"+k().i18n.getMessage("proceedToBlock",t)}static executeBlock({bio:e,id:t,handle:s,name:i}){return new Promise(n=>(w.confirmBlocks&&!window.confirm(b.buildAlert(e,i))?w.whiteList.add(t,s):p.doTheBlock(t,w.tokens.bearerToken,w.tokens.csrfToken),window.setTimeout(n,500)))}}new b}]);